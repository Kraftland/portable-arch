# Maintainer: Kimiblock Moe

pkgname=heroic-games-launcher-portable
pkgver=1
pkgrel=1
epoch=1
pkgdesc="Firefox sandboxed by portable"
arch=('any')
url="https://github.com/Kraftland/portable"
license=('GPL-3.0-or-later')
groups=()
provides=(heroic-games-launcher)
options=(!debug !strip)
conflicts=("heroic-games-launcher")

optdepends=()

makedepends+=(heroic-games-launcher-bin)

checkdepends=()

source=(
	portable-config
	start.sh
	desktop.file
)


md5sums=('0d0e3914e77ee0faf35984b5624afc85'
         '21e405b16724fb50b0140e26d288773a'
         'c8ad9b12ff79ccb596eccc150376cc92')

function prepare() {
	pacman -Ql heroic-games-launcher-bin >file.list
}

function package() {
	depends=("portable")
	while IFS= read -r line; do
		file="$(echo "$line" | awk '{print $2}')"
		if [[ -d ${file} ]]; then
			echo "Omitting Directory"
		else
			if [[ -L "${file}" ]]; then
				mkdir -vp "$(dirname "${pkgdir}/${file}")"
				ln -vsf "$(readlink -f "${file}")" "${pkgdir}/${file}"
			else
				install -vDm755 "${file}" "${pkgdir}/${file}"
			fi
		fi
	done < file.list
	rm -f "${pkgdir}/usr/share/applications"/*
	rm -f "${pkgdir}/usr/bin"/*
	install -Dm644 portable-config \
		"${pkgdir}/usr/lib/portable/info/com.heroicgameslauncher.hgl/config"
	install -Dm755 "start.sh" \
		"${pkgdir}/usr/bin/heroic-games-launcher"
	install -Dm644 "desktop.file" "${pkgdir}/usr/share/applications/com.heroicgameslauncher.hgl.desktop"
}
